---
title: "SQL"
output: html_document
---
## FILTERING COLUMNS AND ROWS

With SQL, you can filter columns and rows by using SELECT for columns and WHERE fOR rows.  Let's look at an example using the Lahman database. So, we should first load that database, along with the package sqldf.

```{r message=FALSE, warning=FALSE}
library(Lahman)
library(sqldf)
```

Suppose now you would like to see the homerun totals for the 1927 Yankees.  You could write the following query:

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='NYA' and yearID=1927"
sqldf(query)
```

###EXAMPLES

Now we will find any instance where a player had more than 40 homeruns but less than 60 strikeouts.

```{r}
query<-"SELECT playerID,teamID,yearID,HR,SO FROM Batting 
WHERE HR>40 and SO<60"
sqldf(query)
```

Let's look at instances of Phillies in the 1970s hitting more than 30 homeruns.

```{r}
query<-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='PHI' and HR>30 and yearID<=1979 and yearID>=1970"
sqldf(query)
```

## ORDER BY

With SQL, you can order the rows of your output. For instance, suppose you want to see every instance of a player hitting more than 50 homeruns, but you would like the players with the most homeruns to be at the top.  We would do the following:

```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE HR>50
ORDER BY HR DESC"

sqldf(query)
```

Another example would be to Find all instances of a player striking out less than 10 times.  Let's make sure each player has had at least 400 at-bats (AB)
We will order by having the least amount of strike outs at the top.  

```{r}
query<-"SELECT playerID,teamID,yearID,SO,AB
FROM Batting
WHERE SO<10 and AB>=400 
ORDER BY SO"

sqldf(query)
```
## AGGREGATION

EXPLANATION (FIX THIS!!!!!)


Let's find Babe Ruth's career Homerun total.

```{r}
query<-"SELECT playerID,sum(HR) 
FROM Batting 
WHERE playerID='ruthba01' 
GROUP BY playerID"

sqldf(query)
```
Now let's find the career homerun totals for all players, but limit the output to totals that are 600 are more.  Let's put the player with the greatest amount at the top and descend from there.

```{r}
query<-"SELECT playerID,sum(HR) 
FROM Batting 
GROUP BY playerID 
HAVING sum(HR)>=600 
ORDER BY sum(HR) DESC" 

sqldf(query)
```

Let's find the players who've averaged more than 30 homeruns per year throughout their careers.  We'll place these in descending order.

```{r}
query<-"SELECT playerID,avg(HR) 
FROM Batting 
GROUP BY playerID 
HAVING avg(HR)>30 
ORDER BY avg(HR) DESC"
sqldf(query)
```
## JOINING

EXPLANATION (FIX THIS!!!!!)

###EXAMPLES

Let's try to find the first and last names of players along with their team, year amount of homeruns- however, let's specify the player as Babe Ruth.

```{r}
query<-"SELECT nameFirst, nameLast, teamID, yearID, HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE Batting.playerID='ruthba01'"

sqldf(query)

```

Now, we will find all instances of players hitting more than 50 homeruns.  We'll include first and last names, team, year, and homeruns ordered by most to least homeruns.

```{r}
query<-"SELECT nameFirst, nameLast, teamID, yearID, HR
FROM Batting INNER JOIN Master
ON Batting.playerID=Master.playerID
WHERE HR>50
ORDER BY HR DESC"

sqldf(query)

```

Let's see Babe Ruth's homerun totals with with player ID, team name, and year. 
```{r}
query<-"SELECT playerID,Batting.HR,Batting.yearID,name
FROM Batting INNER JOIN Teams
ON Batting.teamID=Teams.teamID and Batting.yearID=Teams.yearID
wHERE playerID='ruthba01'"

sqldf(query)
```




